-- CONNECT: takes a connection string and connects.
-- RECONNECT disconnects existing connection and reconnect by using last connection string. It is useful in order to clear cashing etc on client side.
-- IGNOREERROR: continues to execute further queries even if this query is failed.
-- SHOWRESULT: display results of query. Overwrites just_execute program option.
-- NORESULT: do not display results of query. Overwrites just_execute program option.
-- DEFINE <key>=<value> variable declaration. Then variables can be used as such: $(<key>)
-- RESETFOLDER:<folder/path> tries to delete and recreate given folder

DEFINE DBDIR=/tmp/sapiq
RESETFOLDER:$(DBDIR)
DEFINE LOADFILES='/stash/data.csv'

CONNECT:DRIVER=STORDriver;uid=DBA;pwd=sql123;DBN=utility_db;server=storServer;

IGNOREERROR:CREATE DATABASE '$(DBDIR)/test.db' TRANSACTION LOG ON '$(DBDIR)/transaction_log' MESSAGE PATH '$(DBDIR)/msg_log' IQ SIZE 3000 TEMPORARY SIZE 3000 IQ RESERVE 2000 TEMPORARY RESERVE 4000 TEMPORARY PATH '$(DBDIR)/temporary_path' IQ PATH '$(DBDIR)/iq_path' PAGE SIZE 32768 IQ PAGE SIZE 524288 DBA USER 'dba' DBA PASSWORD 'sql123' COLLATION 'ISO9LATIN1' BLOCK SIZE 32768;

CONNECT:DRIVER=STORDriver;uid=DBA;pwd=sql123;DBF=$(DBDIR)/test.db;server=storServer;CharSet=ISO-8859-15;PBUF=8m;PROWS=1000;

SET OPTION PUBLIC.ALLOW_READ_CLIENT_FILE = 'ON';
--SET OPTION PUBLIC.ALLOW_WRITE_CLIENT_FILE = 'ON';


--SHOWRESULT:SELECT * FROM sys.sysoptions where "option"='allow_read_client_file' or "option"='allow_write_client_file';

--sp_iqlmconfig 'allow', 'IQ_VLDBMGMT', '1000'

SET OPTION PUBLIC.DEFAULT_DISK_STRIPING = 'ON';
IGNOREERROR:CREATE DBSPACE USER_MAIN_DBSPACE_1 USING FILE USER_MAIN_1 '$(DBDIR)/USER_MAIN_1_TEST' SIZE 1000 , FILE USER_MAIN_2 '$(DBDIR)/USER_MAIN_2_TEST' SIZE 1000 , FILE USER_MAIN_3 '$(DBDIR)/USER_MAIN_3_TEST' SIZE 1000 , FILE USER_MAIN_4 '$(DBDIR)/USER_MAIN_4_TEST' SIZE 1000 STRIPING ON;

GRANT CREATE ON USER_MAIN_DBSPACE_1 to PUBLIC ; REVOKE CREATE ON IQ_SYSTEM_MAIN from PUBLIC ; SET option PUBLIC.default_dbspace='USER_MAIN_DBSPACE_1';

DROP TABLE IF EXISTS ZDA004;

CREATE TABLE ZDA004( CC_ITEM_INDEX integer NULL, UNKNOWN_INT integer NULL, SRCTATYPE varchar(5) NULL, SRCTAID varchar(22) NULL, SUBPROCESS varchar(4) NULL, BITTYPE varchar(4) NULL, VKONT varchar(12) NULL, GPART varchar(10) NULL, PREPAID varchar(10) NULL, VTREF varchar(20) NULL, VTPOS varchar(6) NULL, SUBAP varchar(1) NULL, PPACC varchar(12) NULL, BILL_BASEDATE timestamp NULL, BILL_FIRST timestamp NULL, BILL_ORIGIN_DATETIME timestamp NULL, BITTIME timestamp NULL, BITDATE_FROM timestamp NULL, BITDATE_TO timestamp NULL, BIT_AMOUNT varchar(50) NULL, BIT_CURR varchar(5) NULL, BIT_QUANTITY varchar(50) NULL, BIT_QTY_UNIT varchar(3) NULL, TAX_INCLUDED varchar(6) NULL, TAX_DET_TYPE varchar(2) NULL, EXT_TAX_DATE timestamp NULL, EXT_TAX_ID varchar(12) NULL, BITREF32 varchar(32) NULL, BITTIME_FROM timestamp NULL, BITTIME_TO timestamp NULL, CONTRACTITEMID varchar(32) NULL, PA8120_POS_ID1 varchar(12) NULL, PA8120_POS_ID2 varchar(12) NULL, PA8120_POS_ID3 varchar(12) NULL, PA8120_POS_ID4 varchar(12) NULL, PA8121_POS_ID1 varchar(12) NULL, PA8121_POS_ID2 varchar(12) NULL, PA8121_POS_ID3 varchar(12) NULL, PA8121_POS_ID4 varchar(12) NULL, ZZACTL_BYTS2CHGE varchar(50) NULL, ZZBALANCE_AFTER varchar(50) NULL, ZZBALANCE_BEFORE varchar(50) NULL, ZZBAL_IDENT varchar(20) NULL, ZZBIT_AMOUNT varchar(50) NULL, ZZCHARGED_ID varchar(20) NULL, ZZCIRCLE_ID varchar(30) NULL, ZZDURATION integer NULL, ZZFILE_NAME varchar(150) NULL, ZZLIMIT_EXCD_VAL varchar(15) NULL, ZZPLAN_ID varchar(10) NULL, ZZQOS_CLASSID varchar(20) NULL, ZZRATE_DEN integer NULL, ZZRATING_GROUP integer NULL, ZZREQ_DL_BYT varchar(50) NULL, ZZREQ_DURATI_SEC varchar(50) NULL, ZZREQ_TOTAL_BYT varchar(50) NULL, ZZREQ_UL_BYT varchar(50) NULL, ZZROAMING_IND varchar(1) NULL, ZZSERVICE_ID varchar(15) NULL, ZZSERVICE_NAME varchar(20) NULL, ZZSESION_ID_NTWK varchar(128) NULL, ZZSUBSCRIBER_IP varchar(40) NULL, ZZSUB_CHRG_TYPE varchar(20) NULL, ZZTECHNICAL_ID varchar(50) NULL, ZZTERMI_CAUSE varchar(50) NULL, ZZTRANS_QTY varchar(50) NULL, ZZTRANS_SUB_TYPE varchar(25) NULL, ZZTRANS_TYPE varchar(25) NULL, ZZUSER_EQUI_TYPE integer NULL, ZZUSER_EQUI_VAL varchar(20) NULL, ZZUSER_LOCATION varchar(50) NULL, SIMULATED varchar(1) NULL, TAX_COUNTRY varchar(3) NULL, DEFREV_CAT varchar(2) NULL, DEFREV_PDATE timestamp NULL, ALLOWANCE varchar(6) NULL, DEFREV_ACTION varchar(2) NULL, DEFREV_ASSKY varchar(30) NULL, DEFREV_CTYPE varchar(4) NULL, ZZACCESS_NTWK_ID varchar(50) NULL, ZZAPN varchar(20) NULL, ZZCHARGING_ID varchar(10) NULL, ZZCORRELATION_ID varchar(40) NULL, ZZFIRSTECI varchar(10) NULL, ZZFIRSTTAC varchar(10) NULL, ZZFSTECGI_MCCMNC varchar(10) NULL, ZZFSTTAGI_MCCMNC varchar(10) NULL, ZZIMSI_MCCMNC varchar(30) NULL, ZZLASTECI varchar(10) NULL, ZZLASTTAC varchar(10) NULL, ZZLSTECGI_MCCMNC varchar(10) NULL, ZZLSTTAGI_MCCMNC varchar(10) NULL, ZZMAX_DL_SPEED varchar(50) NULL, ZZMAX_UL_SPEED varchar(50) NULL, ZZNTWK_NODE_ADDR varchar(40) NULL, ZZNTWK_SERVCE_ID varchar(10) NULL, ZZRAT varchar(5) NULL, ZZSEC_PLAN_ID varchar(30) NULL, ZZSERVICE_TYPE varchar(20) NULL, ZZSESION_ID_CHLD varchar(128) NULL, ZZSGSN_MCCMNC varchar(20) NULL, ZZSPECTRUM_ID varchar(6) NULL, ZZVISITED_CIRCLE varchar(30) NULL, ZZROAMING_PATNR varchar(30) NULL, APPLK varchar(3) NULL, MAKEY varchar(10) NULL, POSTREL varchar(6) NULL, PRINTREL varchar(6) NULL, PRINT_SUBSTITUTE varchar(12) NULL, SPART varchar(2) NULL, BUKRS varchar(4) NULL, GSBER varchar(4) NULL, SEGMT varchar(10) NULL, PRCTR varchar(10) NULL, HVORG varchar(4) NULL, TVORG varchar(4) NULL, KOFIZ varchar(2) NULL, TAX_DATE_TYPE varchar(2) NULL, ERMWSKZ varchar(2) NULL, MWSKZ varchar(2) NULL, XANZA varchar(6) NULL, STAKZ varchar(3) NULL, AGRMT varchar(10) NULL, AGRTY varchar(2) NULL, DISCKEY varchar(8) NULL, DISCKEY_VERSNO varchar(2) NULL, DISC_BASE_AMT varchar(50) NULL, DISC_BASGR varchar(4) NULL, DISC_BIT_NUMBER integer NULL, DISC_CALC_REL varchar(6) NULL, DISC_COND_REL varchar(6) NULL, DISC_GRNUM integer NULL, DISC_LEVEL varchar(4) NULL, DISC_NUM integer NULL, ERMWSKZ_B2B varchar(2) NULL, GPART_VT varchar(10) NULL, MWSKZ_B2B varchar(2) NULL, VKONT_VT varchar(12) NULL, ZZCUM_QTY varchar(60) NULL, ZZCUM_QTY_UNIT varchar(3) NULL, ZZPOLICY_ID varchar(50) NULL, ZZPULSE varchar(50) NULL, ZZPULSE_UNIT varchar(15) NULL, ZZBITCRDATEHR varchar(12) NULL, ZZREASON_ID varchar(40) NULL, ZZUSER_TAC_CODE varchar(8) NULL, BITDATE_TIME time NULL, BITDATE_HOUR smallint NULL, BITDATE_YEARMONTH varchar(6) NULL, DONT_KNOW_1 varchar(6) NULL, FLATFILE_NAME varchar(255) NULL, DONT_KNOW_2 varchar(6) NULL, DONT_KNOW_3 varchar(6) NULL, DONT_KNOW_4 varchar(6) NULL, DONT_KNOW_5 varchar(6) NULL);

LOAD TABLE ZDA004 (cc_item_index,unknown_int,srctatype,srctaid,subprocess,bittype,vkont,gpart,prepaid,vtref,vtpos,subap,ppacc,bill_basedate,bill_first,bill_origin_datetime,bittime,bitdate_from,bitdate_to,bit_amount,bit_curr,bit_quantity,bit_qty_unit,tax_included,tax_det_type,ext_tax_date,ext_tax_id,bitref32,bittime_from,bittime_to,contractitemid,pa8120_pos_id1,pa8120_pos_id2,pa8120_pos_id3,pa8120_pos_id4,pa8121_pos_id1,pa8121_pos_id2,pa8121_pos_id3,pa8121_pos_id4,zzactl_byts2chge,zzbalance_after,zzbalance_before,zzbal_ident,zzbit_amount,zzcharged_id,zzcircle_id,zzduration,zzfile_name,zzlimit_excd_val,zzplan_id,zzqos_classid,zzrate_den,zzrating_group,zzreq_dl_byt,zzreq_durati_sec,zzreq_total_byt,zzreq_ul_byt,zzroaming_ind,zzservice_id,zzservice_name,zzsesion_id_ntwk,zzsubscriber_ip,zzsub_chrg_type,zztechnical_id,zztermi_cause,zztrans_qty,zztrans_sub_type,zztrans_type,zzuser_equi_type,zzuser_equi_val,zzuser_location,simulated,tax_country,defrev_cat,defrev_pdate,allowance,defrev_action,defrev_assky,defrev_ctype,zzaccess_ntwk_id,zzapn,zzcharging_id,zzcorrelation_id,zzfirsteci,zzfirsttac,zzfstecgi_mccmnc,zzfsttagi_mccmnc,zzimsi_mccmnc,zzlasteci,zzlasttac,zzlstecgi_mccmnc,zzlsttagi_mccmnc,zzmax_dl_speed,zzmax_ul_speed,zzntwk_node_addr,zzntwk_servce_id,zzrat,zzsec_plan_id,zzservice_type,zzsesion_id_chld,zzsgsn_mccmnc,zzspectrum_id,zzvisited_circle,zzroaming_patnr,applk,makey,postrel,printrel,print_substitute,spart,bukrs,gsber,segmt,prctr,hvorg,tvorg,kofiz,tax_date_type,ermwskz,mwskz,xanza,stakz,agrmt,agrty,disckey,disckey_versno,disc_base_amt,disc_basgr,disc_bit_number,disc_calc_rel,disc_cond_rel,disc_grnum,disc_level,disc_num,ermwskz_b2b,gpart_vt,mwskz_b2b,vkont_vt,zzcum_qty,zzcum_qty_unit,zzpolicy_id,zzpulse,zzpulse_unit,zzbitcrdatehr,zzreason_id,zzuser_tac_code,bitdate_time,bitdate_hour,bitdate_yearmonth,dont_know_1,flatfile_name,dont_know_2,dont_know_3,dont_know_4,dont_know_5) USING CLIENT FILE $(LOADFILES) DELIMITED BY ',' QUOTES OFF ROW DELIMITED BY '\n' ESCAPES OFF STRIP OFF FORMAT CSV;

--CREATE HG INDEX GPART_INDEX ON ZDA004 ( GPART );

SHOWRESULT:SELECT COUNT(*) FROM ZDA004;

--SHOWRESULT:select * from sp_iqstatus();
